<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>

<!-- include firebase database -->
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-database.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCqVORIxXazIGcKlIaGTKn4YgX8R6Kg5Os",
    authDomain: "fir-chattutorial-5f637.firebaseapp.com",
    databaseURL: "https://fir-chattutorial-5f637.firebaseio.com",
    projectId: "firebasechattutorial",
    storageBucket: "firebasechattutorial.appspot.com",
    messagingSenderId: "1084417645508",
    appId: "1:1084417645508:web:a86d313330cba20b0f2291"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
  var myName = prompt("enter your name"); 
  
  function sendMessage(){
	//get message
	var message = document.getElementById("messaage").value;
	
	//save in database
// 	firebase.database().ref("messages").push().set({
// 		"sender":myName,
// 		"message":message
// 	});
	
	//save in database
	firebase.database().ref("messages").push().set({
		"sender":myName,
		"message":message
	});
	
	//   prevent form form submitting
	return false;
  }
  
  //listen for incoming messages
  firebase.database().ref("messages").on("child_added",function(snapshot){
	 
	 var html="";
	 // give each message a unique ID
	 
	 html +="<li id='message-"+ snapshot.key+"'>";
	 html +=snapshot.val().sender+ ": "+snapshot.val().message;
	 
	 //show delete button if message is sent by me
	 if(snapshot.val().sender == myName){
		 html += "<button data-id='"+snapshot.key+"' onclick='deleteMessage(this);'>";
		 html += "Delete";
		 html += "</button>";
	 }
	 
	 html +="</li>";
	 
	 document.getElementById("messages").innerHTML += html;
	 
  });
  
  function deleteMessage(self){
	  
	  //get message ID
	  var messageId = self.getAttribute("data-id");
	  
	  //delete message
	  firebase.database().ref("messages").child(messageId).remove();
	  
  }
  
  //attach listener for delete message
  firebase.database().ref("messages").on("child_removed", function (snapshot){
	 // remove message node
	 document.getElementById("message-"+snapshot.key).innerHTML = "THIS message has been deleted";
  });
  
</script>

<form onsubmit="return sendMessage();">
	<input id="messaage" placeholder="Enter message" autocomplete="off">
	
	<input type="submit">
</form>

<!-- create a list -->
<ul id="messages"></ul>

</body>
</html>